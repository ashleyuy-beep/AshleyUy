<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commercial | Ashley Uy</title>
  <style>
    /* Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10002;
      transition: opacity 0.5s ease;
    }

    .loading-text {
      font-size: 1rem;
      font-weight: 100;
      animation: blink 1.5s infinite;
    }

    @keyframes blink {
      0%,
      100% {
        opacity: 1;
      }
      50% {
        opacity: 0;
      }
    }

    /* Global Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      font-family: "Helvetica Neue", sans-serif;
      font-weight: 100;
      background-color: #fff;
      padding-top: 60px;
      scroll-behavior: smooth;
    }

    /* Header Navigation */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background-color: rgba(255, 255, 255, 0.95);
      z-index: 10000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em 2em;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      transition: all 0.3s ease;
      will-change: transform;
    }

    .site-logo {
      font-size: 20px;
      font-weight: 100;
      line-height: 1;
      transition: transform 0.3s ease;
    }

    .site-logo:hover {
      transform: translateY(-2px);
    }

    .nav-icons {
      display: flex;
      gap: 1.5em;
      align-items: center;
    }

    .nav-icon {
      cursor: pointer;
      width: 24px;
      height: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .nav-icon:hover {
      transform: scale(1.1);
    }

    .grid-icon {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-gap: 2px;
      width: 18px;
      height: 18px;
    }

    .grid-dot {
      width: 4px;
      height: 4px;
      background-color: black;
      border-radius: 50%;
    }

    .singular-icon {
      display: flex;
      flex-direction: column;
      gap: 4px;
      width: 18px;
    }

    .line {
      width: 18px;
      height: 2px;
      background-color: black;
      transition: width 0.3s ease;
    }

    .nav-icon:hover .line {
      width: 15px;
    }

    .overlay-icon {
      width: 18px;
      height: 18px;
      background-color: black;
      border-radius: 50%;
      transition: transform 0.3s ease;
    }

    .nav-icon:hover .overlay-icon {
      transform: scale(0.9);
    }

    /* View toggle icons */
    #view-toggle {
      position: relative;
      width: 24px;
      height: 24px;
    }

    #grid-view, #singular-view {
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    #grid-view.active, #singular-view.active {
      opacity: 1;
      visibility: visible;
    }

    /* Close button for overlay */
    .close-overlay {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 30px;
      height: 30px;
      cursor: pointer;
      z-index: 10002;
      display: none;
    }

    .close-overlay::before,
    .close-overlay::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: black;
    }

    .close-overlay::before {
      transform: rotate(45deg);
    }

    .close-overlay::after {
      transform: rotate(-45deg);
    }

    .overlay-menu.active .close-overlay {
      display: block;
      animation: fadeIn 0.3s ease forwards;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Overlay Menu */
    .overlay-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: white;
      z-index: 10001;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .overlay-menu.active {
      display: flex;
      opacity: 1;
    }

    .menu-item {
      margin: 15px 0;
      font-size: 28px;
      font-weight: 100;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .menu-item:hover {
      transform: translateY(-3px);
    }

    .menu-item a {
      position: relative;
      display: inline-block;
    }

    .menu-item a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background-color: black;
      transition: width 0.3s ease;
    }

    .menu-item a:hover::after {
      width: 100%;
    }

    /* Gallery Layouts */
    .gallery {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1em;
      padding: 2em;
      transition: all 0.3s ease;
      will-change: opacity, transform;
    }

    .gallery.singular-view {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2em;
    }

    .gallery img {
      width: 100%;
      height: auto;
      object-fit: cover;
      cursor: pointer;
      transition: opacity 0.3s ease, transform 0.3s ease;
      opacity: 0;
      aspect-ratio: 4 / 5;
      transform: translateY(10px);
      will-change: opacity, transform;
    }

    .gallery.singular-view img {
      width: auto;
      max-width: 80%;
      max-height: 80vh;
      aspect-ratio: auto;
    }

    .gallery img.loaded {
      opacity: 1;
      transform: translateY(0);
    }

    .gallery img:hover {
      transform: scale(1.03);
    }

    .gallery.singular-view img:hover {
      transform: none;
    }

    /* Modal - Improved for consistency */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: rgba(0, 0, 0, 0.9);
      opacity: 0;
      transition: opacity 0.3s ease;
      will-change: opacity;
    }

    .modal.show {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 1;
    }

    .modal-content-wrapper {
      position: relative;
      width: 90%;
      max-width: 1200px;
      height: 85%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transform: scale(0.98);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      will-change: transform, opacity;
    }

    .modal.show .modal-content-wrapper {
      transform: scale(1);
      opacity: 1;
    }

    .modal-image-container {
      flex: 1;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .modal-content {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      transition: opacity 0.3s ease, transform 0.3s ease;
      will-change: opacity, transform;
    }

    .thumbnail-container {
      width: 100%;
      height: 100px;
      margin-top: auto;
    }

    .thumbnail-strip {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px 0;
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
      height: 100%;
      align-items: center;
    }

    .thumbnail-strip::-webkit-scrollbar {
      height: 6px;
    }

    .thumbnail-strip::-webkit-scrollbar-track {
      background: transparent;
    }

    .thumbnail-strip::-webkit-scrollbar-thumb {
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 6px;
    }

    .thumbnail {
      width: 80px;
      height: 80px;
      object-fit: cover;
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.3s ease, transform 0.3s ease, border 0.3s ease;
      border: 2px solid transparent;
      flex-shrink: 0;
    }

    .thumbnail:hover {
      opacity: 0.9;
      transform: translateY(-3px);
    }

    .thumbnail.active {
      opacity: 1;
      border: 2px solid white;
    }

    .close {
      position: absolute;
      top: 15px;
      right: 15px;
      color: #fff;
      font-size: 24px;
      font-weight: 300;
      background: none;
      border: none;
      cursor: pointer;
      z-index: 1100;
      transition: transform 0.3s ease, color 0.3s ease;
      width: 30px;
      height: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .close:hover,
    .close:focus {
      color: #bbb;
      transform: rotate(90deg);
    }

    /* Navigation arrows for modal */
    .modal-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: white;
      font-size: 30px;
      background: rgba(0, 0, 0, 0.3);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s ease, background 0.3s ease;
      z-index: 1100;
    }

    .modal-nav:hover {
      opacity: 1;
      background: rgba(0, 0, 0, 0.5);
    }

    .modal-prev {
      left: 20px;
    }

    .modal-next {
      right: 20px;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: #666;
      margin-top: 20px;
      transition: opacity 0.3s ease;
    }

    footer a {
      color: #333;
      transition: color 0.3s ease;
    }

    footer a:hover {
      color: #000;
    }

    /* Loading indicator for images */
    .loading-indicator {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-top-color: #000;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      z-index: 9999;
      display: none;
    }

    @keyframes spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .gallery {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      .gallery {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5em;
        padding: 1em;
      }

      .header {
        padding: 1em;
      }

      .site-logo {
        font-size: 18px;
      }

      .loading-text {
        font-size: 1.5rem;
      }

      .close {
        font-size: 24px;
        top: 15px;
        right: 15px;
      }

      .modal-content-wrapper {
        width: 95%;
        height: 85%;
      }

      .menu-item {
        font-size: 24px;
      }

      .thumbnail {
        width: 60px;
        height: 60px;
      }

      .thumbnail-container {
        height: 80px;
      }

      .modal-nav {
        width: 40px;
        height: 40px;
        font-size: 24px;
      }
    }

    @media (max-width: 480px) {
      .gallery {
        grid-template-columns: repeat(1, 1fr);
        gap: 0.3em;
      }

      .header {
        padding: 0.5em 1em;
        height: 50px;
      }

      .loading-text {
        font-size: 1.2rem;
      }

      .nav-icons {
        gap: 1em;
      }

      .thumbnail {
        width: 50px;
        height: 50px;
      }

      .thumbnail-container {
        height: 70px;
      }

      .modal-nav {
        width: 35px;
        height: 35px;
        font-size: 20px;
      }
    }

    /* Remove default link styling */
    a {
      text-decoration: none;
      color: inherit;
    }

    @media (hover: none) {
      .gallery img:hover {
        transform: none;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <h2 class="loading-text">Commercial</h2>
  </div>

  <!-- Loading indicator for async operations -->
  <div class="loading-indicator" id="loading-indicator"></div>

  <!-- Header Navigation -->
  <header class="header">
    <div class="site-logo">
      <a href="home.html">Ashley Uy</a>
    </div>
    <div class="nav-icons">
      <div id="view-toggle">
        <!-- Grid view icon (shown when in singular view) -->
        <div class="nav-icon" id="grid-view">
          <div class="grid-icon">
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
            <div class="grid-dot"></div>
          </div>
        </div>
        <!-- Singular view icon (shown when in grid view) -->
        <div class="nav-icon" id="singular-view" class="active">
          <div class="singular-icon">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
          </div>
        </div>
      </div>
      <div class="nav-icon" id="menu-toggle">
        <div class="overlay-icon"></div>
      </div>
    </div>
  </header>

  <!-- Overlay Menu -->
  <div class="overlay-menu" id="overlay-menu">
    <div class="close-overlay" id="close-overlay"></div>
    <div class="menu-item"><a href="home.html">Home</a></div>
    <div class="menu-item"><a href="about.html">About</a></div>
    <div class="menu-item"><a href="commercial.html">Commercial</a></div>
    <div class="menu-item"><a href="personal.html">Personal</a></div>
  </div>

  <div class="gallery" id="gallery">
    <!-- Images will be added dynamically via JavaScript -->
  </div>

  <!-- Improved Modal Structure -->
  <div class="modal" id="image-modal">
    <button class="close" aria-label="Close modal">&times;</button>
    <div class="modal-content-wrapper">
      <div class="modal-image-container">
        <img class="modal-content" id="modal-image" alt="Featured image">
      </div>
      <div class="thumbnail-container">
        <div class="thumbnail-strip" id="thumbnail-strip">
          <!-- Thumbnails will be added dynamically -->
        </div>
      </div>
    </div>
    <button class="modal-nav modal-prev" aria-label="Previous image">&lt;</button>
    <button class="modal-nav modal-next" aria-label="Next image">&gt;</button>
  </div>

  <!-- Footer -->
  <footer>
    Website Designed by <a href="https://robingabrieldesign.com" target="_blank">Robin Gabriel Â©</a>
  </footer>

  <script>
    // Image data - split into initial and additional batches for better performance
    const initialImages = [
      "images/Commercial/IMG_8420.JPG",
      "images/Commercial/IMG_8563.JPG",
      "images/Commercial/IMG_8569.JPG",
      "images/Commercial/IMG_8585.JPG",
      "images/Commercial/IMG_8298 Large.jpeg",
      "images/Commercial/IMG_9791 Large.jpeg",
      "images/Commercial/IMG_9796 Large.jpeg",
      'images/Commercial/IMG_0166 Large.jpeg',
      'images/Commercial/Alyssa Hot choco (2) Large.jpeg',
      'images/Commercial/Image 3 Large.jpeg',
      'images/Commercial/Image 4 (3) Large.jpeg',
      'images/Commercial/IMG_0220 Large.jpeg',
      'images/Commercial/IMG_0167 Large.jpeg',
      'images/Commercial/IMG_0240 Large.jpeg',
      'images/Commercial/IMG_0246 Large.jpeg',
      'images/Commercial/IMG_0254 Large.jpeg',
      'images/Commercial/IMG_0255 Large.jpeg',
      'images/Commercial/IMG_0279 Large.jpeg',
      'images/Commercial/IMG_0288 Large.jpeg',
      'images/Commercial/IMG_0291 Large.jpeg'
    ];
    
    const additionalImages = [
      'images/Commercial/IMG_0272 Large.jpeg',
      'images/Commercial/IMG_0299 Large.jpeg',
      'images/Commercial/IMG_0300 Large.jpeg',
      'images/Commercial/IMG_0337 Large.jpeg',
      'images/Commercial/IMG_0403 Large.jpeg',
      'images/Commercial/IMG_0407 Large.jpeg',
      'images/Commercial/IMG_0338 Large.jpeg',
      'images/Commercial/Untitled (4) Large.jpeg',
      'images/Commercial/IMG_0324 Large.jpeg',
      'images/Commercial/Untitled (5) Large.jpeg',
      'images/Commercial/Untitled (4) (2) Large.jpeg',
      "images/Commercial/unnamed-4.jpg",
      "images/Commercial/unnamed.jpg",
      "images/Commercial/unnamed-3.jpg",
      "images/Commercial/unnamed-2.jpg",
      "images/Commercial/DSCF0232.JPG",
      "images/Commercial/DSCF0239.JPG",
      "images/Commercial/DSCF0241 copy.JPG",
      "images/Commercial/DSCF0241.JPG",
      "images/Commercial/DSCF0253.JPG",
      "images/Commercial/FOUND.JPG",
      "images/Commercial/IMG_0010.JPG",
      "images/Commercial/IMG_0017.JPG",
      "images/Commercial/IMG_0018.JPG",
      "images/Commercial/IMG_0024.JPG",
      "images/Commercial/IMG_0026.JPG",
      "images/Commercial/IMG_0032.JPG",
      "images/Commercial/test edits/000017550001 Medium.png",
      "images/Commercial/test edits/000017550002 Medium.png",
      "images/Commercial/test edits/000017550006 copy Medium.png",
      "images/Commercial/test edits/000017550007 Medium.png",
      "images/Commercial/test edits/000017550008 Medium.png",
      "images/Commercial/test edits/000017560001 Medium.png",
      "images/Commercial/test edits/000017560003 Medium.png",
      "images/Commercial/test edits/000017560008 Medium.png",
      "images/Commercial/test edits/Image 6 Medium.png",
      "images/Commercial/passport-frontback aligned copy/black back 1 .jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER8.jpg",
      "images/Commercial/passport-frontback aligned copy/dark brown back 1 .jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER3.jpg",
      "images/Commercial/passport-frontback aligned copy/dark green back.jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER5.jpg",
      "images/Commercial/passport-frontback aligned copy/avo green back.jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER9.jpg",
      "images/Commercial/passport-frontback aligned copy/grey back.jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER6.jpg",
      "images/Commercial/passport-frontback aligned copy/white back.jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER2.jpg",
      "images/Commercial/passport-frontback aligned copy/yellow back .jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER1.jpg",
      "images/Commercial/passport-frontback aligned copy/light blue back 1.jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER10.jpg",
      "images/Commercial/passport-frontback aligned copy/light brown back.jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER4.jpg",
      "images/Commercial/passport-frontback aligned copy/orange back.jpg",
      "images/Commercial/LAYOVERPASSPORT copy/LAYOVER7.jpg"
    ];

    // Combine all images for modal navigation
    let allImages = [...initialImages];
    let loadedAllImages = false;
    let isLoading = false;

    // DOM elements
    const gallery = document.getElementById("gallery");
    const modal = document.getElementById("image-modal");
    const modalImage = document.getElementById("modal-image");
    const thumbnailStrip = document.getElementById("thumbnail-strip");
    const closeModal = document.querySelector(".close");
    const loadingScreen = document.getElementById("loading-screen");
    const loadingIndicator = document.getElementById("loading-indicator");
    const overlayMenu = document.getElementById("overlay-menu");
    const menuToggle = document.getElementById("menu-toggle");
    const closeOverlay = document.getElementById("close-overlay");
    const gridViewBtn = document.getElementById("grid-view");
    const singularViewBtn = document.getElementById("singular-view");
    const viewToggle = document.getElementById("view-toggle");
    const prevButton = document.querySelector(".modal-prev");
    const nextButton = document.querySelector(".modal-next");

    // Initialize view mode
    let isGridView = true;
    let modalOpen = false;
    updateViewIcons();

    // Function to show loading indicator
    function showLoading() {
      isLoading = true;
      loadingIndicator.style.display = "block";
    }

    // Function to hide loading indicator
    function hideLoading() {
      isLoading = false;
      loadingIndicator.style.display = "none";
    }

    // Function to update view icons based on current view
    function updateViewIcons() {
      if (isGridView) {
        // In grid view, show singular icon
        singularViewBtn.classList.add("active");
        gridViewBtn.classList.remove("active");
      } else {
        // In singular view, show grid icon
        gridViewBtn.classList.add("active");
        singularViewBtn.classList.remove("active");
      }
    }

    // Toggle menu with animation
    menuToggle.addEventListener("click", () => {
      overlayMenu.classList.add("active");
    });

    // Close overlay with X button
    closeOverlay.addEventListener("click", () => {
      overlayMenu.classList.remove("active");
    });

    // Toggle view modes with debounce
    let viewToggleTimeout;
    viewToggle.addEventListener("click", () => {
      if (viewToggleTimeout) return;
      
      viewToggleTimeout = setTimeout(() => {
        viewToggleTimeout = null;
      }, 500);
      
      isGridView = !isGridView;
      gallery.classList.toggle("singular-view");
      updateViewIcons();
      
      // Apply staggered animation to images when switching views
      const allImages = gallery.querySelectorAll("img");
      allImages.forEach((img, index) => {
        // Use requestAnimationFrame for smoother animations
        requestAnimationFrame(() => {
          img.style.transitionDelay = `${index * 0.02}s`;
          img.classList.remove("loaded");
          
          // Re-add the loaded class after a short delay
          setTimeout(() => {
            img.classList.add("loaded");
            
            // Reset the transition delay after animation completes
            setTimeout(() => {
              img.style.transitionDelay = "";
            }, 300);
          }, 50);
        });
      });
    });

    // Load more images when scrolling near the bottom
    function loadMoreImagesIfNeeded() {
      if (loadedAllImages || isLoading) return;
      
      const scrollPosition = window.scrollY + window.innerHeight;
      const documentHeight = document.documentElement.scrollHeight;
      
      // If we're near the bottom (within 500px), load more images
      if (scrollPosition > documentHeight - 500) {
        loadMoreImages();
      }
    }

    // Load additional images
    function loadMoreImages() {
      if (loadedAllImages || isLoading) return;
      
      showLoading();
      
      // Get a batch of additional images (10 at a time)
      const imagesToLoad = additionalImages.splice(0, 10);
      
      if (imagesToLoad.length === 0) {
        loadedAllImages = true;
        hideLoading();
        return;
      }
      
      // Add these images to our main images array
      allImages.push(...imagesToLoad);
      
      // Create and append image elements
      const fragment = document.createDocumentFragment();
      
      imagesToLoad.forEach((src, index) => {
        const img = document.createElement("img");
        img.loading = "lazy"; // Native lazy loading
        img.src = src;
        img.alt = `Commercial image ${allImages.length - imagesToLoad.length + index + 1}`;
        img.dataset.index = allImages.length - imagesToLoad.length + index;
        
        img.addEventListener("load", () => {
          requestAnimationFrame(() => {
            img.classList.add("loaded");
          });
        });
        
        img.addEventListener("error", () => {
          console.error(`Failed to load image: ${src}`);
          img.style.display = "none";
        });
        
        img.addEventListener("click", openModal);
        fragment.appendChild(img);
      });
      
      gallery.appendChild(fragment);
      
      // Hide loading after a short delay
      setTimeout(hideLoading, 300);
    }

    // Populate gallery with initial images
    function populateGallery() {
      const fragment = document.createDocumentFragment();
      let loadedCount = 0;
      
      initialImages.forEach((src, index) => {
        const img = document.createElement("img");
        img.loading = "lazy"; // Native lazy loading
        img.src = src;
        img.alt = `Commercial image ${index + 1}`;
        img.dataset.index = index;
        
        img.addEventListener("load", () => {
          loadedCount++;
          
          // Add a slight delay before showing each image for a staggered effect
          setTimeout(() => {
            requestAnimationFrame(() => {
              img.classList.add("loaded");
            });
          }, index * 30);
          
          // Hide loading screen when enough images are loaded
          if (loadedCount >= Math.min(8, initialImages.length)) {
            setTimeout(() => {
              loadingScreen.style.opacity = "0";
              setTimeout(() => {
                loadingScreen.style.display = "none";
              }, 500);
            }, 500);
          }
        });
        
        img.addEventListener("error", () => {
          console.error(`Failed to load image: ${src}`);
          loadedCount++;
          img.style.display = "none";
        });
        
        img.addEventListener("click", openModal);
        fragment.appendChild(img);
      });
      
      gallery.appendChild(fragment);
    }

    // Create thumbnails for modal
    function createThumbnails() {
      thumbnailStrip.innerHTML = "";
      const fragment = document.createDocumentFragment();
      
      allImages.forEach((src, i) => {
        const thumbnail = document.createElement("img");
        thumbnail.loading = "lazy";
        thumbnail.src = src;
        thumbnail.alt = `Thumbnail ${i + 1}`;
        thumbnail.classList.add("thumbnail");
        thumbnail.dataset.index = i;
        
        thumbnail.addEventListener("click", () => {
          updateModalImage(i);
        });
        
        fragment.appendChild(thumbnail);
      });
      
      thumbnailStrip.appendChild(fragment);
    }

    // Open modal with clicked image
    function openModal(e) {
      if (modalOpen) return;
      modalOpen = true;
      
      const clickedImage = e.target;
      const index = parseInt(clickedImage.dataset.index);
      
      // Create thumbnails if they don't exist
      if (thumbnailStrip.children.length === 0) {
        createThumbnails();
      }
      
      // Set initial modal image
      modalImage.src = allImages[index];
      modalImage.dataset.index = index;
      modalImage.style.opacity = "0";
      modalImage.style.transform = "scale(0.95)";
      
      // Show modal
      modal.classList.add("show");
      document.body.style.overflow = "hidden";
      
      // Update active thumbnail
      updateActiveThumbnail(index);
      
      // Fade in modal image after a short delay
      setTimeout(() => {
        modalImage.style.opacity = "1";
        modalImage.style.transform = "scale(1)";
      }, 100);
      
      // Scroll active thumbnail into view
      const activeThumb = thumbnailStrip.querySelector(".thumbnail.active");
      if (activeThumb) {
        activeThumb.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
      }
    }

    // Update modal image
    function updateModalImage(index, direction = null) {
      // Add slide animation based on direction if provided
      if (direction) {
        const slideOut = direction === 'next' ? 'translateX(-30px)' : 'translateX(30px)';
        const slideIn = direction === 'next' ? 'translateX(30px)' : 'translateX(-30px)';
        
        modalImage.style.opacity = "0";
        modalImage.style.transform = slideOut;
        
        setTimeout(() => {
          modalImage.src = allImages[index];
          modalImage.dataset.index = index;
          modalImage.style.transform = slideIn;
          
          // Ensure image is loaded before animating in
          modalImage.onload = () => {
            requestAnimationFrame(() => {
              modalImage.style.opacity = "1";
              modalImage.style.transform = "translateX(0)";
            });
          };
          
          // Fallback if onload doesn't fire
          setTimeout(() => {
            modalImage.style.opacity = "1";
            modalImage.style.transform = "translateX(0)";
          }, 50);
          
          updateActiveThumbnail(index);
          
          // Scroll the active thumbnail into view
          const activeThumb = thumbnailStrip.querySelector(".thumbnail.active");
          if (activeThumb) {
            activeThumb.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
          }
        }, 200);
      } else {
        // Simple fade transition for thumbnail clicks
        modalImage.style.opacity = "0";
        
        setTimeout(() => {
          modalImage.src = allImages[index];
          modalImage.dataset.index = index;
          
          modalImage.onload = () => {
            requestAnimationFrame(() => {
              modalImage.style.opacity = "1";
            });
          };
          
          // Fallback
          setTimeout(() => {
            modalImage.style.opacity = "1";
          }, 50);
          
          updateActiveThumbnail(index);
        }, 200);
      }
    }

    // Update active thumbnail
    function updateActiveThumbnail(index) {
      const thumbnails = thumbnailStrip.querySelectorAll(".thumbnail");
      thumbnails.forEach((thumb) => {
        if (parseInt(thumb.dataset.index) === index) {
          thumb.classList.add("active");
        } else {
          thumb.classList.remove("active");
        }
      });
    }

    // Close modal
    function closeModalFunction() {
      if (!modalOpen) return;
      
      modal.style.opacity = "0";
      
      setTimeout(() => {
        modal.classList.remove("show");
        modal.style.opacity = "1";
        document.body.style.overflow = "";
        modalOpen = false;
      }, 300);
    }

    // Show next image in modal
    function showNextImage() {
      const currentIndex = parseInt(modalImage.dataset.index);
      const nextIndex = (currentIndex + 1) % allImages.length;
      updateModalImage(nextIndex, 'next');
    }

    // Show previous image in modal
    function showPreviousImage() {
      const currentIndex = parseInt(modalImage.dataset.index);
      const previousIndex = (currentIndex - 1 + allImages.length) % allImages.length;
      updateModalImage(previousIndex, 'prev');
    }

    // Event listeners
    closeModal.addEventListener("click", closeModalFunction);
    prevButton.addEventListener("click", showPreviousImage);
    nextButton.addEventListener("click", showNextImage);

    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        closeModalFunction();
      }
    });

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (modal.classList.contains("show")) {
          closeModalFunction();
        } else if (overlayMenu.classList.contains("active")) {
          overlayMenu.classList.remove("active");
        }
      } else if (e.key === "ArrowRight" && modal.classList.contains("show")) {
        showNextImage();
      } else if (e.key === "ArrowLeft" && modal.classList.contains("show")) {
        showPreviousImage();
      }
    });

    // Touch support for mobile devices
    let touchStartX = 0;
    let touchEndX = 0;

    function handleSwipe() {
      if (touchStartX - touchEndX > 50) {
        // Swipe left, show next image
        showNextImage();
      } else if (touchEndX - touchStartX > 50) {
        // Swipe right, show previous image
        showPreviousImage();
      }
    }

    modal.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    modal.addEventListener("touchend", (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    // Close overlay menu when clicking on a menu item
    document.querySelectorAll(".menu-item a").forEach(item => {
      item.addEventListener("click", () => {
        overlayMenu.style.opacity = "0";
        setTimeout(() => {
          overlayMenu.classList.remove("active");
          overlayMenu.style.opacity = "1";
        }, 300);
      });
    });

    // Throttle function to limit how often a function can be called
    function throttle(func, limit) {
      let inThrottle;
      return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
          func.apply(context, args);
          inThrottle = true;
          setTimeout(() => inThrottle = false, limit);
        }
      };
    }

    // Initialize
    window.addEventListener("load", () => {
      populateGallery();
      
      // Add scroll event listener for infinite loading
      window.addEventListener("scroll", throttle(loadMoreImagesIfNeeded, 200));
    });
  </script>
</body>
</html>